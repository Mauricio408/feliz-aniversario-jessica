<!DOCTYPE html>
<html>
  <head>
    <title>Feliz Aniversário, Jessica Mozão! - AR</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    
    <!-- A-Frame 1.4.0 (Versão Moderna) -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <!-- AR.js para A-Frame -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <!-- Gestures -->
    <script src="https://raw.githack.com/fcor/arjs-gestures/master/dist/gestures.js"></script>

    <style>
      /* Estilos para a tela inicial (overlay) */
      #overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.9); z-index: 9999;
        display: flex; justify-content: center; align-items: center; flex-direction: column;
        color: white; font-family: sans-serif; text-align: center;
      }
      .btn {
        margin-top: 30px; padding: 14px 30px; background: #FF33A1; /* Rosa choque */
        border-radius: 8px; font-weight: bold; cursor: pointer;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        transition: background-color 0.3s;
      }
      .btn:hover {
        background: #ef2d5e;
      }
    </style>
  </head>

  <body style="margin: 0; overflow: hidden;">
    
    <!-- Script de Interação -->
    <script>
      AFRAME.registerComponent('surprise-interaction', {
        init: function () {
          var el = this.el;
          el.addEventListener('click', function () {
            
            // 1. Feedback de clique: Vibração visual
            el.setAttribute('animation__click', {
                property: 'scale',
                from: '1.2 1.2 1.2', 
                to: '1.4 1.4 1.4',
                dur: 150,
                dir: 'alternate',
                startEvents: 'click' 
            });
            // Limpa a animação de clique após execução
            setTimeout(() => {
                if(el.removeAttribute) el.removeAttribute('animation__click');
            }, 300);
            
            // 2. Mudança de Cor
            const newColor = '#FF33A1'; 
            
            // Tenta mudar cor do texto ou do objeto
            const textEntity = el.querySelector('[text]');
            if (textEntity) {
                textEntity.setAttribute('text', 'color', newColor); 
            } else if (el.getAttribute('text')) {
                el.setAttribute('text', 'color', newColor);
            }
            if (el.tagName === 'A-ICOSAHEDRON') {
                el.setAttribute('color', newColor); 
            }
          });
        }
      });
    </script>
    
    <!-- Tela de Início -->
    <div id="overlay">
      <div style="font-size: 32px; font-weight: bold;">Surpresa AR de Aniversário!</div>
      <div style="margin-top: 20px; font-size: 18px; color: #ccc;">Encontre os 3 Marcadores (Hiro, Kanji, Letter A)</div>
      <div class="btn">TOQUE PARA INICIAR O AMOR</div>
    </div>

    <a-scene
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
      renderer="logarithmicDepthBuffer: true; colorManagement: true;"
      vr-mode-ui="enabled: false"
      gesture-detector
      id="scene"
    >

      <a-assets>
        <!-- ⚠️ Lembre-se de substituir este link por um link direto de MP3 válido -->
        <audio id="music" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" preload="auto"></audio>
      </a-assets>

      <a-sound src="#music" autoplay="true" loop="true" volume="0.5" id="background-music"></a-sound>

      <!-- ================================================= -->
      <!-- MARCADOR 1: HIRO -->
      <!-- ================================================= -->
      <a-marker preset="hiro">
        <a-entity 
          position="0 1.2 0" 
          rotation="-90 0 0" 
          scale="0.001 0.001 0.001" 
          surprise-interaction
          gesture-handler
          /* Animação convertida para sintaxe moderna (atributo animation) */
          animation="property: scale; from: 0.001 0.001 0.001; to: 1.5 1.5 1.5; dur: 2500; easing: easeOutElastic; loop: false"
        >
          <!-- Fundo -->
          <a-plane 
            width="4.5" height="1.5" color="#000000" opacity="0.6" 
            position="0 0 -0.01" shader="standard" material="metalness: 0.1; roughness: 0.8;">
          </a-plane>
            
          <!-- Texto (Aspas corrigidas: width: 4 sem aspas extras) -->
          <a-entity
            text="value: Jessica, meu amor, a vida com voce e a celebracao mais linda. Feliz 26 anos! ❤️; align: center; width: 4; color: #FFFFFF; font: exo2bold;"
            position="0 0 0"
          ></a-entity>
        </a-entity>
      </a-marker>
      
      <!-- ================================================= -->
      <!-- MARCADOR 2: KANJI -->
      <!-- ================================================= -->
      <a-marker preset="kanji">
        <!-- Coração (Aspas corrigidas em animation__pulse e text) -->
        <a-icosahedron 
          position="0 1.5 0" 
          radius="0.8" 
          color="#FF0055" 
          material="shader: standard; metalness: 0.8; roughness: 0.1;"
          surprise-interaction
          gesture-handler
          animation="property: rotation; to: 360 360 360; loop: true; dur: 10000; easing: linear;"
          animation__pulse="property: scale; from: 1 1 1; to: 1.1 1.1 1.1; dir: alternate; loop: true; dur: 1500;"
        >
          <!-- Texto -->
          <a-entity
            text="value: VOCE E O MEU PRESENTE. (Clique e Sinta o Amor!); align: center; width: 3; color: #FFFFFF; font: exo2bold;"
            position="0 0.2 0"
            rotation="0 0 0"
            scale="0.5 0.5 0.5"
          ></a-entity>
        </a-icosahedron>
      </a-marker>

      <!-- ================================================= -->
      <!-- MARCADOR 3: LETTER A -->
      <!-- ================================================= -->
      <a-marker preset="letterA">
        <a-entity 
          position="0 1.2 0" 
          rotation="-90 0 0" 
          scale="1.2 1.2 1.2" 
          surprise-interaction
          gesture-handler
        >
          <!-- Fundo -->
          <a-plane 
            width="4.5" height="1.5" color="#000000" opacity="0.6" 
            position="0 0 -0.01" shader="standard" material="metalness: 0.1; roughness: 0.8;">
          </a-plane>
            
          <!-- Texto -->
          <a-entity
            text="value: Obrigado por ser a luz, a aventura e o conforto do meu mundo. Que venham muitos anos ao seu lado. Eu te amo, para sempre. ✨; align: center; width: 4; color: #EFEF00; font: exo2bold;"
            position="0 0 0"
          ></a-entity>
          
          <!-- Animação convertida -->
          <a-animation 
             attribute="rotation" to="-90 10 -5" dir="alternate" loop="true" dur="4000"
          ></a-animation>
          <!-- Correção para sintaxe moderna de animação no elemento pai ou filho se a tag a-animation falhar -->
           <a-entity animation="property: rotation; to: -90 10 -5; dir: alternate; loop: true; dur: 4000"></a-entity>
        </a-entity>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      // Lógica do Botão de Início
      const overlay = document.getElementById('overlay');
      overlay.addEventListener('click', function() {
        overlay.style.display = 'none';
        
        // Tocar música
        const sound = document.querySelector('#background-music');
        if(sound && sound.components && sound.components.sound) {
            sound.components.sound.playSound();
        }

        // Retomar contexto de áudio
        try {
          const AudioContext = window.AudioContext || window.webkitAudioContext;
          if (AudioContext) {
            const context = new AudioContext();
            context.resume().then(() => console.log('Audio Context resumed'));
          }
        } catch (e) {
          console.error("Audio context error:", e);
        }
      });
    </script>
  </body>
</html>
